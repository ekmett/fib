language: c++
dist: trusty
sudo: false

matrix:
  fast_finish: true
  include:
    - os: osx
      env: C_COMPILER=gcc CXX_COMPILER=g++
      compiler: g++

    - os: osx
      env: C_COMPILER=clang CXX_COMPILER=clang++
      compiler: clang++

    - os: linux
      env: C_COMPILER=gcc-6 CXX_COMPILER=g++-6
      compiler: g++-6
      addons:
        apt:
          packages: [g++-6, libboost-context-dev, libevent-dev]
          sources: [ubuntu-toolchain-r-test]

    - os: linux
      env: C_COMPILER=clang-3.6 CXX_COMPILER=clang++-3.6
      compiler: clang++-3.6
      addons: 
        apt:
          packages: [clang-3.6, libboost-context-dev, libevent-dev]
          sources: [ubuntu-toolchain-r-test, llvm-toolchain-precise-3.6]

    - os: linux
      env: C_COMPILER=clang-3.7 CXX_COMPILER=clang++-3.7
      compiler: clang++-3.7
      addons:
        apt:
          packages: [clang-3.7, libboost-context-dev, libevent-dev]
          sources: [ubuntu-toolchain-r-test, llvm-toolchain-precise-3.7]

before_install:
 - if [[ "${C_COMPILER}" != "" ]]; then export CC=${CC_COMPILER}; export CMAKE_C_COMPILER=${C_COMPILER}; fi
 - if [[ "${CXX_COMPILER}" != "" ]]; then export CXX=${CXX_COMPILER}; export CMAKE_CXX_COMPILER=${CXX_COMPILER}; fi
 - ${CMAKE_CXX_COMPILER} -v
 - cmake --version

install:
 - |
   if [[ "${TRAVIS_OS_NAME}" == "osx" ]]; then
     if ! brew ls --version boost &>/dev/null; then brew install boost; fi
   fi
 - |
   if [[ "${TRAVIS_OS_NAME}" == "osx" ]]; then
     if ! brew ls --version libevent &>/dev/null; then brew install libevent; fi
   fi
 - |
   if [[ "${TRAVIS_OS_NAME}" == "osx" ]]; then
     if ! brew ls --version cmake &>/dev/null; then brew install cmake; fi
   fi

script:
 - mkdir build
 - cd build
 - cmake ${CMAKE_OPTIONS} .. && make

notifications:
  irc:
    channels:
      - "irc.freenode.org#haskell-lens"
    skip_join: true
    template:
      - "\x0313fib\x0f/\x0306%{branch}\x0f \x0314%{commit}\x0f %{message} \x0302\x1f%{build_url}\x0f"
